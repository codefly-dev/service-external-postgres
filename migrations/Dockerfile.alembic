FROM python:3.12-alpine

# Install PostgreSQL client
RUN apk add --no-cache postgresql-client

# Create non-root user
RUN adduser -D appuser

RUN pip install alembic psycopg2-binary sqlalchemy requests python-dotenv pgvector

WORKDIR /workspace

# Switch to non-root user
USER appuser

ENV PYTHONDONTWRITEBYTECODE=1